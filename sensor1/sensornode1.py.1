#!/usr/bin/python3

#sensor 1
import json
import time #gaperlu dimasukin di skripsi
import datetime
import paho.mqtt.client as mqtt_client
from collections import OrderedDict

pub = mqtt_client.Client()
pub.connect("192.168.56.7", port=1883)

with open('datasensor.json', 'r') as f:
        data = f.read().split('\n')

data.remove('')

try:
        # Publish
        data2 = {}
        for i in data:
                temp = i.strip('{|}').split(', ')
                for i in temp:
                        key, value = i.split(": ")
                        key = key.strip("'")
                        data2[key] = value

                timestamp = str(datetime.datetime.now())
                print(timestamp)
                data3 = {
                        "ID": "1",
                        "BRIGHTNESS": data2['BRIGHTNESS'],
                        "TEMPERATURE":  data2['TEMPERATURE'],
                        "HUMIDITY":  data2['HUMIDITY'],
                        "TIMESTAMP": timestamp
                };
                data_up=json.dumps(data3)
                pub.publish("/sensor/1", data_up)
                print("\npublishing..")
                print(data_up)
                time.sleep(1)

except KeyboardInterrupt:
    pub.disconnect()
    exit(0)
